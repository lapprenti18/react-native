{"ast":null,"code":"export var animationParameter = function animationParameter(animationParam) {\n  \"worklet\";\n\n  if (typeof animationParam === \"number\") {\n    throw new Error(\"Expected Animation as parameter\");\n  }\n\n  return typeof animationParam === \"function\" ? animationParam() : animationParam;\n};\nexport var defineAnimation = function defineAnimation(factory) {\n  \"worklet\";\n\n  if (_WORKLET) {\n    return factory();\n  }\n\n  return factory;\n};\nexport var withPause = function withPause(animationParam, paused) {\n  \"worklet\";\n\n  return defineAnimation(function () {\n    \"worklet\";\n\n    var nextAnimation = animationParameter(animationParam);\n\n    var animation = function animation(state, now) {\n      var lastTimestamp = state.lastTimestamp,\n          elapsed = state.elapsed;\n\n      if (paused.value) {\n        state.elapsed = now - lastTimestamp;\n        return false;\n      }\n\n      var dt = now - elapsed;\n      var finished = nextAnimation.animation(nextAnimation, dt);\n      state.current = nextAnimation.current;\n      state.lastTimestamp = dt;\n      return finished;\n    };\n\n    var start = function start(state, value, now, previousState) {\n      state.lastTimestamp = now;\n      state.elapsed = 0;\n      nextAnimation.start(nextAnimation, value, now, previousState);\n    };\n\n    return {\n      animation: animation,\n      start: start\n    };\n  });\n};\nexport var withBouncing = function withBouncing(animationParam, lowerBound, upperBound) {\n  \"worklet\";\n\n  return defineAnimation(function () {\n    \"worklet\";\n\n    var nextAnimation = animationParameter(animationParam);\n\n    var animation = function animation(state, now) {\n      var finished = nextAnimation.animation(nextAnimation, now);\n      var velocity = nextAnimation.velocity,\n          current = nextAnimation.current;\n      state.current = current;\n\n      if (velocity < 0 && state.current <= lowerBound || velocity > 0 && state.current >= upperBound) {\n        state.current = velocity < 0 ? lowerBound : upperBound;\n        nextAnimation.velocity *= -0.5;\n      }\n\n      return finished;\n    };\n\n    var start = function start(_state, value, now, previousState) {\n      nextAnimation.start(nextAnimation, value, now, previousState);\n    };\n\n    return {\n      animation: animation,\n      start: start\n    };\n  });\n};","map":{"version":3,"sources":["Animations.ts"],"names":["animationParameter","animationParam","defineAnimation","factory","withPause","nextAnimation","animation","lastTimestamp","elapsed","state","paused","now","dt","finished","start","withBouncing","velocity","current"],"mappings":"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","sourcesContent":["import Animated from \"react-native-reanimated\";\n\ndeclare let _WORKLET: boolean;\n\nexport interface AnimationState {\n  current: number;\n}\n\nexport interface PhysicsAnimationState extends AnimationState {\n  velocity: number;\n}\n\nexport type Animation<\n  State extends AnimationState = AnimationState,\n  PrevState = State\n> = {\n  animation: (animation: State, now: number) => boolean;\n  start: (\n    animation: State,\n    value: number,\n    now: number,\n    lastAnimation: PrevState\n  ) => void;\n} & State;\n\nexport type AnimationParameter<State extends AnimationState = AnimationState> =\n  | Animation<State>\n  | (() => Animation<State>)\n  | number;\n\n/**\n *  @summary Access animations passed as parameters safely on both the UI and JS thread with the proper static types.\n *  Animations can receive other animations as parameter.\n */\nexport const animationParameter = <\n  State extends AnimationState = AnimationState\n>(\n  animationParam: AnimationParameter<State>\n) => {\n  \"worklet\";\n  if (typeof animationParam === \"number\") {\n    throw new Error(\"Expected Animation as parameter\");\n  }\n  return typeof animationParam === \"function\"\n    ? animationParam()\n    : animationParam;\n};\n\n/**\n *  @summary Declare custom animations that can be invoked on both the JS and UI thread.\n *  @example\n *  defineAnimation(() => {\n      \"worklet\";\n      // ...animation code\n      return {\n        animation,\n       start\n      }\n    });\n */\nexport const defineAnimation = <\n  S extends AnimationState = AnimationState,\n  Prev extends AnimationState = AnimationState\n>(\n  factory: () => Omit<Animation<S, Prev>, keyof S>\n) => {\n  \"worklet\";\n  if (_WORKLET) {\n    return (factory() as unknown) as number;\n  }\n  return (factory as unknown) as number;\n};\n\ninterface PausableAnimation extends AnimationState {\n  lastTimestamp: number;\n  elapsed: number;\n}\n\n/**\n *  @summary Make an animation pausable. The state of the animation (paused or not)\n *  is controlled by a boolean shared value.\n *  @example\n    const progress = useSharedValue(0);\n    const paused = useSharedValue(false);\n    useEffect(() => {\n      progress.value = withPause(withLoop(withTiming(1)), paused);\n    }, []);\n */\nexport const withPause = (\n  animationParam: AnimationParameter,\n  paused: Animated.SharedValue<boolean>\n) => {\n  \"worklet\";\n  return defineAnimation<PausableAnimation>(() => {\n    \"worklet\";\n    const nextAnimation = animationParameter(animationParam);\n    const animation = (state: PausableAnimation, now: number) => {\n      const { lastTimestamp, elapsed } = state;\n      if (paused.value) {\n        state.elapsed = now - lastTimestamp;\n        return false;\n      }\n      const dt = now - elapsed;\n      const finished = nextAnimation.animation(nextAnimation, dt);\n      state.current = nextAnimation.current;\n      state.lastTimestamp = dt;\n      return finished;\n    };\n    const start = (\n      state: PausableAnimation,\n      value: number,\n      now: number,\n      previousState: AnimationState\n    ) => {\n      state.lastTimestamp = now;\n      state.elapsed = 0;\n      nextAnimation.start(nextAnimation, value, now, previousState);\n    };\n    return {\n      animation,\n      start,\n    };\n  });\n};\n\n/**\n *  @summary Add a bouncing behavior to a physics-based animation.\n *  An animation is defined as being physics-based if it contains a velocity in its state.\n *  @example\n    // will bounce if the animations hits the position 0 or 100\n    withBouncing(withDecay({ velocity }), 0, 100)\n */\nexport const withBouncing = (\n  animationParam: AnimationParameter<PhysicsAnimationState>,\n  lowerBound: number,\n  upperBound: number\n): number => {\n  \"worklet\";\n  return defineAnimation<PhysicsAnimationState, PhysicsAnimationState>(() => {\n    \"worklet\";\n    const nextAnimation = animationParameter(animationParam);\n    const animation = (state: PhysicsAnimationState, now: number) => {\n      const finished = nextAnimation.animation(nextAnimation, now);\n      const { velocity, current } = nextAnimation;\n      state.current = current;\n      if (\n        (velocity < 0 && state.current <= lowerBound) ||\n        (velocity > 0 && state.current >= upperBound)\n      ) {\n        state.current = velocity < 0 ? lowerBound : upperBound;\n        nextAnimation.velocity *= -0.5;\n      }\n      return finished;\n    };\n    const start = (\n      _state: PhysicsAnimationState,\n      value: number,\n      now: number,\n      previousState: PhysicsAnimationState\n    ) => {\n      nextAnimation.start(nextAnimation, value, now, previousState);\n    };\n    return {\n      animation,\n      start,\n    };\n  });\n};\n"]},"metadata":{},"sourceType":"module"}